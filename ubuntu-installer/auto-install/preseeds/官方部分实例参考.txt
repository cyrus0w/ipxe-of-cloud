##参考文档：https://ubuntu.com/server/docs/install/autoinstall
## https://ubuntu.com/server/docs/install/autoinstall-reference#reporting
## https://curtin.readthedocs.io/en/latest/topics/storage.html

##！！！！！！！切记每一行前面空格不能是tab键！！！！！！！！！

备份

    config:
    - id: sda
      type: disk
      ptable: gpt
      path: /dev/sda
      name: main_disk
      wipe: superblock
      grub_device: true
    - id: bios_boot_partition
      type: partition
      wipe: superblock
      size: 1MB
      device: sda
      flag: bios_grub
    - id: sda-part1
      type: partition
      number: 1
      size: -1
      device: sda
      flag: boot
    - id: sda-part1-format-root
      type: format
      fstype: ext4
      volume: sda-part1
    - id: sda-part1-mount-root
      type: mount
      path: /
      device: sda-part1-format-root










storage:
    grub:
      reorder_uefi: False
    swap:
      size: 4000MB
    config:
    - {ptable: gpt, path: /dev/sda, preserve: false, name: '', grub_device: false,
      type: disk, id: disk-sda}
    - {device: disk-sda, size: 250MB, wipe: superblock, flag: boot, number: 1,
      preserve: false, grub_device: true, type: partition, id: partition-sda1}
    - {fstype: fat32, volume: partition-sda1, preserve: false, type: format, id: format-2}
    - {device: disk-sda, size: 500MB, wipe: superblock, flag: linux, number: 2,
      preserve: false, grub_device: false, type: partition, id: partition-sda2}
    - {fstype: ext4, volume: partition-sda2, preserve: false, type: format, id: format-0}
    - {device: disk-sda, size: -1, flag: linux, number: 3, preserve: false,
      grub_device: false, type: partition, id: partition-sda3}
    - name: vg-0
      devices: [partition-sda3]
      preserve: false
      type: lvm_volgroup
      id: lvm-volgroup-vg-0
    - {name: lv-root, volgroup: lvm-volgroup-vg-0, size: 100%, preserve: false,
      type: lvm_partition, id: lvm-partition-lv-root}
    - {fstype: ext4, volume: lvm-partition-lv-root, preserve: false, type: format,
      id: format-1}
    - {device: format-1, path: /, type: mount, id: mount-2}
    - {device: format-0, path: /boot, type: mount, id: mount-1}
    - {device: format-2, path: /boot/efi, type: mount, id: mount-3}



  storage:
    config:
     - id: sda
       type: disk
       ptable: gpt
       model: QEMU HARDDISK
       path: /dev/sda
       name: main_disk
       wipe: superblock
       grub_device: true
     - id: sda-part1
       type: partition
       number: 1
       size: -1
       device: sda
       flag: boot
     - id: sda-part1-format-root
       type: format
       fstype: ext4
       volume: sda-part1
     - id: sda-part1-mount-root
       type: mount
       path: /
       device: sda-part1-format-root



network:
    network:
      version: 2
      ethernets:
        eth0:
          dhcp4: yes
	    eth1:
          dhcp4: yes
	   bonds:
            bond0:
                dhcp4: yes
                interfaces:
                    - eth0
                    - eth1
                parameters:
                    mode: active-backup
                    primary: eth0
                    
                    
                    


####部分参数的中文解释说明
storage:
    swap:
        size: 1024
    config:
        - type: disk  #1.定义匹配任意类型磁盘
          id: sda	#给指定的磁盘类型设置一个别名
		  match:	#定义磁盘的属性
		    path: /dev/sda	#磁盘路径
			ptable: gpt	#gpt格式，其他可选参数：msdos
			grub_device: true	#grub引导是否安装到此盘
		    ssd: yes	#是ssd磁盘
			#size: largest	#如果存在多个匹配项，则使用最大(largest)或最小(smallest)的磁盘，而不是任意磁盘
			#model: Seagate	#磁盘品牌是希捷，其他可选参数：QEMU HARDDISK（虚拟机磁盘）
          #serial: ADATA_SX8200PNP_XXXXXXXXXXX	#磁盘序列号
        - type: partition	#2.开始定义分区
          id: sda-boot	#别名：boot分区
          device: sda	#要分区的磁盘别名id
		  number: 1		#序号
          size: 500M	#分配大小，格式有：“ 1G”，“ 512M”，“ 50％”
        - type: partition
          id: sda-efi	#efi分区
          device: sda
		  number: 2
          size: 500M	
        - type: partition
          id: sda-root	#root分区
          device: sda
		  number: 3
          size: -1
	    - id: sda-boot-format	#3.接着定义文件系统
          type: format
          fstype: ext4
          volume: sda-boot
        - id: sda-efi-format
          type: format
          fstype: fat32
          volume: sda-efi
		- id: sda-root-format
          type: format
          fstype: ext4
          volume: sda-root
        - id: sda-root-mount	#4.最后挂载
          type: mount
          path: /
          device: sda-root-format





##以下是动态网络配置
network:
    network:
        version: 2
        ethernets:
          eno1:
            dhcp4: true
        
##以下是静态网络配置
network:
    network:
        version: 2
        # if specified, can only realistically have that value, as networkd cannot
        # render wifi/3G.
        renderer: NetworkManager
        ethernets:
          # opaque ID for physical interfaces, only referred to by other stanzas
          id0:
            match:
              macaddress: 00:11:22:33:44:55
            wakeonlan: true
            dhcp4: true
            addresses:
              - 192.168.14.2/24
              - 192.168.14.3/24
              - "2001:1::1/64"
            gateway4: 192.168.14.1
            gateway6: "2001:1::2"
            nameservers:
              search: [foo.local, bar.local]
              addresses: [8.8.8.8]
            routes:
              - to: 0.0.0.0/0
                via: 11.0.0.1
                table: 70
                on-link: true
                metric: 3
            routing-policy:
              - to: 10.0.0.0/8
                from: 192.168.14.2/24
                table: 70
                priority: 100
              - to: 20.0.0.0/8
                from: 192.168.14.3/24
                table: 70
                priority: 50
            # only networkd can render on-link routes and routing policies
            renderer: networkd
          lom:
            match:
              driver: ixgbe
            # you are responsible for setting tight enough match rules
            # that only match one device if you use set-name
            set-name: lom1
            dhcp6: true
          switchports:
            # all cards on second PCI bus unconfigured by
            # themselves, will be added to br0 below
            match:
              name: enp2*
            mtu: 1280
        wifis:
          all-wlans:
            # useful on a system where you know there is
            # only ever going to be one device
            match: {}
            access-points:
              "Joe's home":
                # mode defaults to "infrastructure" (client)
                password: "s3kr1t"
          # this creates an AP on wlp1s0 using hostapd
          # no match rules, thus the ID is the interface name
          wlp1s0:
            access-points:
              "guest":
                 mode: ap
                 # no WPA config implies default of open
        bridges:
          # the key name is the name for virtual (created) interfaces
          # no match: and set-name: allowed
          br0:
            # IDs of the components; switchports expands into multiple interfaces
            interfaces: [wlp1s0, switchports]
            dhcp4: true
      
##多网卡bond绑定
network:
    network:
        version: 2
        ethernets:
            enp0s25:
               dhcp4: yes
            enp3s0: {}
            enp4s0: {}
        bonds:
            bond0:
                dhcp4: yes
                interfaces:
                    - enp3s0
                    - enp4s0
                parameters:
                    mode: active-backup
                    primary: enp3s0
                    
##lvm分区示例
storage:
  version: 1
  config:
    - id: sda
      type: disk
      ptable: msdos
      model: QEMU HARDDISK
      path: /dev/vdb
      name: main_disk
    - id: sda1
      type: partition
      size: 3GB
      device: sda
      flag: boot
    - id: sda_extended
      type: partition
      size: 5G
      flag: extended
      device: sda
    - id: sda2
      type: partition
      size: 2G
      flag: logical
      device: sda
    - id: sda3
      type: partition
      size: 3G
      flag: logical
      device: sda
    - id: volgroup1
      name: vg1
      type: lvm_volgroup
      devices:
          - sda2
          - sda3
    - id: lvmpart1
      name: lv1
      size: 1G
      type: lvm_partition
      volgroup: volgroup1
    - id: lvmpart2
      name: lv2
      type: lvm_partition
      volgroup: volgroup1
    - id: sda1_root
      type: format
      fstype: ext4
      volume: sda1
    - id: lv1_fs
      name: storage
      type: format
      fstype: fat32
      volume: lvmpart1
    - id: lv2_fs
      name: storage
      type: format
      fstype: ext3
      volume: lvmpart2
    - id: sda1_mount
      type: mount
      path: /
      device: sda1_root
    - id: lv1_mount
      type: mount
      path: /srv/data
      device: lv1_fs
    - id: lv2_mount
      type: mount
      path: /srv/backup
      device: lv2_fs

##raid分区示例 
storage:
  version: 1
  config:
     - id: sda
       type: disk
       ptable: gpt
       model: QEMU HARDDISK
       path: /dev/vdb
       name: main_disk
       grub_device: 1
     - id: bios_boot_partition
       type: partition
       size: 1MB
       device: sda
       flag: bios_grub
     - id: sda1
       type: partition
       size: 3GB
       device: sda
     - id: sdb
       type: disk
       ptable: gpt
       model: QEMU HARDDISK
       path: /dev/vdc
       name: second_disk
     - id: sdb1
       type: partition
       size: 3GB
       device: sdb
     - id: sdc
       type: disk
       ptable: gpt
       model: QEMU HARDDISK
       path: /dev/vdd
       name: third_disk
     - id: sdc1
       type: partition
       size: 3GB
       device: sdc
     - id: mddevice
       name: md0
       type: raid
       raidlevel: 5
       devices:
         - sda1
         - sdb1
         - sdc1
     - id: md_root
       type: format
       fstype: ext4
       volume: mddevice
     - id: md_mount
       type: mount
       path: /
       device: md_root 

storage:
  config:
  - type: disk
    id: disk-0
    ptable: gpt
    path: /dev/vda
    wipe: superblock
    grub_device: true
  - type: disk
    id: disk-1
    path: /dev/vdb
    wipe: superblock
  - type: disk
    id: disk-2
    path: /dev/vdc
    wipe: superblock
  - type: partition
    id: part-0
    device: disk-0
    size: 1048576
    flag: bios_grub
  - type: partition
    id: part-1
    device: disk-0
    size: 21471690752
  - id: raid-0
    type: raid
    name: md0
    raidlevel: 1
    devices: [disk-2, disk-1]
    ptable: gpt
  - type: partition
    id: part-2
    device: raid-0
    size: 10737418240
  - type: partition
    id: part-3
    device: raid-0
    size: 10735321088,
  - type: format
    id: fs-0
    fstype: ext4
    volume: part-1
  - type: format
    id: fs-1
    fstype: xfs
    volume: part-2
  - type: format
    id: fs-2
    fstype: ext4
    volume: part-3
  - type: mount
    id: mount-0
    device: fs-0
    path: /
  - type: mount
    id: mount-1
    device: fs-1
    path: /srv
  - type: mount
    id: mount-2
    device: fs-2
    path: /home
  version: 1       